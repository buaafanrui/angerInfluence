## 说明

这是《大数据时代的计算舆论学：原理、应用与案例》一书中
"网络舆论中的情感分析"这一章节所涉及到的代码和数据。

### 运行环境

作者执行代码的环境和依赖库如下所示，读者如果需要执行仓库中的代码，
需要安装python 2.7的开发环境，并安装列表中的依赖库。这些依赖库如向后兼容，
也可使用比列表列出更高的版本，否则请安装列出的版本。

* python 2.7
* jieba 0.38
* numpy 1.20.0
* scipy 0.18.1
* networkx 1.9.1
* matplotlib 1.4.3

### 情绪标签说明

为编程方便，代码文件中每种情绪赋予了一个编号，对应关系如下：

* -1：无法判断情绪
* 0：愤怒
* 1：厌恶
* 2：高兴
* 3：悲伤

### 执行过程

代码执行过程如下：

1. 情感分类

   情感分类代码在emotion_classifier文件夹中，可参考emotion_cla_exmaple.py文件中的例子


2. 提取数据
   
    首先从数据库中提取微博数据，生成网络图，并计算网络图中每个用户的情绪。
   由于用户环境中无数据库，因此这部分所提供的代码供参考。
   
    最终输出文件为10_graph.txt，该文件共227,122行，
   每行表示一条边，即一条用户连接，每行分为四列，第一列和第二列为有连接关系的两个用户，第三列为两用户之间的转发数，即连接强度。
   第四列为一个列表，其中数据为第一列用户的情绪计算结果，列表中的四个数值分别为愤怒、厌恶、高兴、悲伤四种情绪微博的数量。
   
    例如，文件第一行为`0   1   12  [151, 97, 385, 135]`，含义如下：
    用户0和1之间有连接关系，他们互相转发了12条微博数据。其中，用户0所发布的
   愤怒、厌恶、高兴和悲伤四种情绪的微博数量分别为151, 97, 385, 135。
   
    用户1627825392的情绪计算结果则在
   `1   0   12  [1431, 908, 1757, 956]`一行中中列出。


3. 计算不同距离的用户对

    可直接执行cal_distance.py得到不同距离的用户对，结果输出到distances文件夹中，同时这些用户对结果为以下各步骤中的输入


4. 计算用户情绪相关性

    执行correlation.py，先执行main函数计算相关性结果，然后执行draw_chart函数绘图


5. 计算随机打散后的用户情绪相关性

    执行random_corr.py，先执行main函数计算相关性结果，再执行draw_chart函数绘图


6. 计算连接强度和情绪相关性的关系

    执行weight_corr.py，先执行main函数计算相关性结果，再执行draw_chart函数绘图


7. 计算节点度和聚集系数

    执行node_properties.py，计算节点度和聚集系数，结果保存在results/node_properties.txt文件，
    该文件为后续步骤的输入


8. 计算节点度、聚集系数和情绪相关性的关系

    执行degree_corr.py和clustering_corr.py


### 文件列表

* emotion_classifier: 该文件夹为情感分类的代码文件，使用示例见emotion_cla_exmaple.py文件
* User.py、CreateGraph.py和db_trans.py: 这两个文件为从原始数据库中提取数据的代码，由于读者环境中无原始数据库 ，因此无需执行，仅作参考
* 10_graph.txt: 从数据库中提取出的用户关系及情绪数据，该用户网络中边强度阈值为10，这是后续所有计算的输入文件
* read_graph.py: 从10_graph.txt文件中读取网络图和用户情绪数据的代码，被以下各代码文件所引用  
* cal_distance.py: 根据网络图计算不同距离的用户对，计算结果输出到distances文件夹中
* correlation.py: 计算不同距离用户对之前四种情绪的相关性
* random_corr.py: 计算随机打散后的情绪相关性
* weight_corr.py: 计算连接强度和情绪相关性的关系  
* node_properties.py: 计算节点的度和聚集系数
* degree_corr.py: 计算节点度和情绪相关性的关系
* clustering_corr.py: 计算节点聚集系数和情绪相关性的关系
